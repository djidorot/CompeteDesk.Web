@model CompeteDesk.ViewModels.Settings.SettingsIndexViewModel
@{
    ViewData["Title"] = "Settings";
    ViewData["LayoutFluid"] = true;
    ViewData["UseSidebar"] = true;
}

@section Styles {
    <link rel="stylesheet" href="~/css/settings.css" asp-append-version="true" />
}

<div class="cd-page">
    <div class="cd-page__head">
        <div>
            <h1 class="cd-page__title">Settings</h1>
            <p class="cd-page__sub">Manage your profile and preferences.</p>
        </div>

        <div class="cd-page__actions">
            @if (!string.IsNullOrWhiteSpace(ViewData["SavedMessage"] as string))
            {
                <span class="cd-badge cd-badge--ok">@ViewData["SavedMessage"]</span>
            }
            @if (!string.IsNullOrWhiteSpace(ViewData["ExportError"] as string))
            {
                <span class="cd-badge cd-badge--warn">@ViewData["ExportError"]</span>
            }
            @if (!string.IsNullOrWhiteSpace(ViewData["ResetMessage"] as string))
            {
                <span class="cd-badge cd-badge--info">@ViewData["ResetMessage"]</span>
            }
        </div>
    </div>

    <div class="cd-grid-2">
        <section class="cd-card">
            <div class="cd-card__head">
                <h2 class="cd-card__title">Profile</h2>
            </div>
            <div class="cd-card__body">
                <div class="cd-kv">
                    <div class="cd-kv__row">
                        <div class="cd-kv__k">Email</div>
                        <div class="cd-kv__v">@Model.Email</div>
                    </div>
                    <div class="cd-kv__row">
                        <div class="cd-kv__k">Display name</div>
                        <div class="cd-kv__v">@Model.DisplayName</div>
                    </div>
                </div>

                <p class="cd-muted mt-3">
                    Profile editing can be enabled next (name, avatar, timezone, org/workspace defaults).
                </p>
            </div>
        </section>

        <section class="cd-card">
            <div class="cd-card__head">
                <h2 class="cd-card__title">Security</h2>
            </div>
            <div class="cd-card__body">
                <ul class="cd-list">
                    <li>Password change is available under <strong>Account</strong> (Identity pages).</li>
                    <li>Optional: enable 2FA, recovery codes, and session management.</li>
                </ul>

                <div class="cd-actions mt-3">
                    <a class="cd-btn cd-btn--ghost" href="/Identity/Account/Manage">Open Account</a>
                </div>
            </div>
        </section>

        <section class="cd-card cd-card--span">
            <div class="cd-card__head cd-card__head--split">
                <div>
                    <h2 class="cd-card__title">AI Preferences</h2>
                    <p class="cd-muted">Control how AI drafts plans, summaries, and recommendations.</p>
                </div>
            </div>

            <div class="cd-card__body">
                <form asp-action="Index" asp-controller="Settings" method="post" class="cd-form">
                    @Html.AntiForgeryToken()

                    <div class="cd-form__grid">
                        <div class="cd-field">
                            <label class="cd-label" for="Verbosity">Verbosity</label>
                            <select class="cd-select" id="Verbosity" name="Verbosity">
                                <option value="Short" selected="@(Model.Verbosity == "Short")">Short</option>
                                <option value="Balanced" selected="@(Model.Verbosity == "Balanced")">Balanced</option>
                                <option value="Detailed" selected="@(Model.Verbosity == "Detailed")">Detailed</option>
                            </select>
                            <div class="cd-help">Controls answer length and level of detail in AI outputs.</div>
                        </div>

                        <div class="cd-field">
                            <label class="cd-label" for="Tone">Default tone</label>
                            <select class="cd-select" id="Tone" name="Tone">
                                <option value="Executive" selected="@(Model.Tone == "Executive")">Executive</option>
                                <option value="Analytical" selected="@(Model.Tone == "Analytical")">Analytical</option>
                                <option value="Tactical" selected="@(Model.Tone == "Tactical")">Tactical</option>
                            </select>
                            <div class="cd-help">Sets the default writing style for AI drafts.</div>
                        </div>
                    </div>

                    <div class="cd-toggles">
                        <label class="cd-toggle">
                            <input type="checkbox" name="AutoDraftPlans" value="true" @(Model.AutoDraftPlans ? "checked" : "") />
                            <span>Auto-draft plans</span>
                        </label>

                        <label class="cd-toggle">
                            <input type="checkbox" name="AutoSummaries" value="true" @(Model.AutoSummaries ? "checked" : "") />
                            <span>Auto-summaries</span>
                        </label>

                        <label class="cd-toggle">
                            <input type="checkbox" name="AutoRecommendations" value="true" @(Model.AutoRecommendations ? "checked" : "") />
                            <span>Auto-recommendations</span>
                        </label>

                        <label class="cd-toggle">
                            <input type="checkbox" name="StoreDecisionTraces" value="true" @(Model.StoreDecisionTraces ? "checked" : "") />
                            <span>Store AI decision traces</span>
                        </label>
                    </div>

                    <div class="cd-divider"></div>

                    <div class="cd-sectionhead">
                        <h3 class="cd-sectionhead__title">Data &amp; Analytics Controls</h3>
                        <p class="cd-muted">Retention for log-like data (AI History, analysis reports) and export tools.</p>
                    </div>

                    <div class="cd-form__grid">
                        <div class="cd-field">
                            <label class="cd-label" for="RetentionDays">Data retention</label>
                            <select class="cd-select" id="RetentionDays" name="RetentionDays">
                                <option value="30" selected="@(Model.RetentionDays == 30)">Keep 30 days</option>
                                <option value="90" selected="@(Model.RetentionDays == 90)">Keep 90 days</option>
                                <option value="365" selected="@(Model.RetentionDays == 365)">Keep 365 days</option>
                            </select>
                            <div class="cd-help">Older AI traces and analysis logs are automatically deleted.</div>
                        </div>

                        <div class="cd-field">
                            <label class="cd-label" for="ExportFormat">Default export format</label>
                            <select class="cd-select" id="ExportFormat" name="ExportFormat">
                                <option value="json" selected="@(Model.ExportFormat?.ToLower() == "json")">JSON</option>
                                <option value="csv" selected="@(Model.ExportFormat?.ToLower() == "csv")">CSV</option>
                            </select>
                            <div class="cd-help">Used when you click Export (you can still override per export).</div>
                        </div>
                    </div>

                    <div class="cd-actions">
                        <button type="submit" class="cd-btn cd-btn--primary">Save settings</button>

                        <div class="cd-export">
                            <span class="cd-export__label">Export:</span>
                            <a class="cd-btn cd-btn--ghost"
                               href="@Url.Action("Export","Settings", new { entity = "actions", format = Model.ExportFormat })">Actions</a>
                            <a class="cd-btn cd-btn--ghost"
                               href="@Url.Action("Export","Settings", new { entity = "strategies", format = Model.ExportFormat })">Strategies</a>
                            <a class="cd-btn cd-btn--ghost"
                               href="@Url.Action("Export","Settings", new { entity = "metrics", format = Model.ExportFormat, days = 30 })">Metrics</a>
                        </div>
                    </div>
                </form>

                <div class="cd-divider"></div>

                <form asp-action="ResetDemoData" asp-controller="Settings" method="post" class="cd-form cd-reset">
                    @Html.AntiForgeryToken()
                    <div class="cd-sectionhead">
                        <h3 class="cd-sectionhead__title">Reset demo data</h3>
                        <p class="cd-muted">Deletes your Workspaces, Strategies, Actions, War Room items, reports, habits, and AI traces. Your account remains.</p>
                    </div>

                    <div class="cd-reset__row">
                        <div class="cd-field">
                            <label class="cd-label" for="ResetConfirm">Type <code>RESET</code> to confirm</label>
                            <input class="cd-input" id="ResetConfirm" name="ResetConfirm" placeholder="RESET" />
                        </div>

                        <button type="submit" class="cd-btn cd-btn--danger">Reset</button>
                    </div>

                    <div class="cd-help">
                        Tip: Use this for onboarding/testing if you want a clean slate.
                    </div>
                </form>
            </div>
        </section>

        <section class="cd-card">
            <div class="cd-card__head">
                <h2 class="cd-card__title">Notifications</h2>
            </div>
            <div class="cd-card__body">
                <ul class="cd-list">
                    <li>Future: email alerts for overdue actions, new intel, and AI run results.</li>
                    <li>Future: daily digest and weekly summary.</li>
                </ul>
            </div>
        </section>
    </div>
</div>
